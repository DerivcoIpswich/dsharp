<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="15.0">
  <PropertyGroup>
    <SourceDirectory>$(SolutionDir)</SourceDirectory>
    <OutputDirectory>$(ProjectDir)Output\</OutputDirectory>
  </PropertyGroup>
  
  <Target Name="BuildPackages" AfterTargets="Build">
    <ItemGroup>
      <NuGetProperties Include="libPath=$(SourceDirectory)Output\$(Configuration);
                                buildPath=$(SourceDirectory)DSharp.Build\bin\$(Configuration)\net461;
                                consolePath=$(SourceDirectory)DSharp.Shell\bin\$(Configuration)\net461;
                                scriptPath=$(SourceDirectory)DSharp.Script\dist;
                                version=$(PackageVersion);
                                configuration=$(Configuration)" />
    </ItemGroup>

    <MakeDir Directories="$(OutputDirectory)Packages" />
    
    <Exec Command="$(SolutionDir)Tools\bin\nuget pack %(NuSpec.Identity) -OutputDirectory $(OutputDirectory)Packages -NoPackageAnalysis -Properties @(NuGetProperties)" />
  </Target>
  
  <Target Name="CleanPackages" AfterTargets="Clean">
    <Delete Files="$(OutputDirectory)**\*.nupkg" />
  </Target>
  
  <Target Name="RebuildPackages" DependsOnTargets="CleanPackages;BuildPackages" AfterTargets="Rebuild" />
</Project>